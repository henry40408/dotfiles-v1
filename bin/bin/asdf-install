#!/usr/bin/env ruby

require 'open3'

all_plugins = []
all_versions = []

open(File.expand_path('~/.tool-versions')) do |file|
  file.each do |line|
    plugin, *versions = line.split(/\s+/)
    all_plugins << plugin
    versions.each do |version|
      all_versions << [plugin, version]
    end
  end
end

all_plugins.each do |plugin|
  IO.popen("asdf plugin add #{plugin}") do |io|
    while (line = io.gets) do
      print line
    end
  end
end

all_versions.each do |(plugin, version)|
  IO.popen("asdf install #{plugin} #{version}") do |io|
    while (line = io.gets) do
      print line
    end
  end
end
